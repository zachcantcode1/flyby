server {
    listen 80;
    server_name _;

    # Gzip compression
    gzip on;
    gzip_types text/plain text/css application/json application/javascript text/xml application/xml;

    # Root directory for static files
    root /usr/share/nginx/html;
    index index.html;

    # SPA routing - serve index.html for all non-file requests
    location / {
        try_files $uri $uri/ /index.html;
    }

    # OpenSky Auth API proxy (for flight tracks)
    location /api/opensky-auth/ {
        proxy_pass https://auth.opensky-network.org/auth/;
        proxy_ssl_server_name on;
        proxy_set_header Host auth.opensky-network.org;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # OpenSky API proxy (for flight tracks)
    location /api/opensky/ {
        proxy_pass https://opensky-network.org/api/;
        proxy_ssl_server_name on;
        proxy_set_header Host opensky-network.org;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # FlightRadar24 API proxy
    location /api/fr24/ {
        proxy_pass https://fr24api.flightradar24.com/api/;
        proxy_ssl_server_name on;
        proxy_set_header Host fr24api.flightradar24.com;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # Airport Data API proxy
    location /api/airport-data/ {
        proxy_pass https://airport-data.com/;
        proxy_ssl_server_name on;
        proxy_set_header Host airport-data.com;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # Planespotters API proxy
    location /api/planespotters/ {
        proxy_pass https://api.planespotters.net/pub/photos/reg/;
        proxy_ssl_server_name on;
        proxy_set_header Host api.planespotters.net;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # ntfy internal proxy (for sending notifications from the browser)
    location /ntfy/ {
        # Use Docker's internal DNS resolver for dynamic resolution
        resolver 127.0.0.11 valid=10s;
        set $ntfy_upstream http://ntfy:80;
        proxy_pass $ntfy_upstream/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # Cache static assets
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
    }
}
